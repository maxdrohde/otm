---
title: "Overview"
author: "Max Rohde"
---

```{r}
library(otm)
library(tidyverse)

# Set global ggplot theme
theme_set(cowplot::theme_cowplot(font_size=12,
                                 font_family = "Source Sans Pro"))
```

```{r}
params <-
  list(
    cutpoints = c(
      2.704779695,
      3.283274970,
      3.759044255,
      6.152768017,
      9.928567811,
      12.594702347,
      19.080282386
    ),
    beta_yprev = c(
      0.006164718,
      3.668244235,
      4.756980385,
      7.696745715,
      11.098149358,
      15.471452261
    ),
    beta_time = -0.013360423,
    beta_treatment = -0.094833284
  )
```

## Generate data

```{r}
df <- generate_dataset(params,
                       treatment = 0,
                       baseline_y = 4,
                       absorb = TRUE,
                       times = 1:28,
                       n_subjects = 500)
```

## Compute SOPs analytically

```{r}
theoretical_sop <-
compute_sop(params = params,
            covariates = 1,
            baseline_y = 4,
            absorb = TRUE,
            times = 1:28,
            output_type = "df") |>
  arrange(day, y) |>
  pull(sop)
```

Demonstrate SOP plotting function:

```{r}
compute_sop(params = params,
            covariates = 1,
            baseline_y = 4,
            absorb = TRUE,
            times = 1:28,
            output_type = "df") |>
generate_sop_plot()
```

